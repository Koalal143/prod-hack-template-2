include:
  - template: Security/Secret-Detection.gitlab-ci.yml
  - local: /deploy/jobs/build.yml
  - local: /deploy/jobs/deploy.yml

stages:
- test
- secret-detection
# - build
- deploy

.global-variables:
  variables:
    SSH_USER: "$ENV_SSH_USER"
    SSH_HOST: "$ENV_SSH_HOST"
    SSH_PRIVATE_KEY_BASE64: "$ENV_PRIVATE_KEY_BASE64"

variables:
  SECRET_DETECTION_ENABLED: 'true'

secret_detection:
  stage: secret-detection

# build:
#   stage: build
#   extends:
#     - .build

deploy:
  stage: deploy
  extends:
    - .global-variables
    - .deploy